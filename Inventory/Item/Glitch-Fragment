local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer

local candle = game:GetObjects("rbxassetid://89988270878660")[1]
candle.Parent = localPlayer.Backpack

local function playAnimation(character, animationId)
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        local animator = humanoid:FindFirstChildOfClass("Animator")
        if not animator then
            animator = Instance.new("Animator")
            animator.Parent = humanoid
        end
        local animation = Instance.new("Animation")
        animation.AnimationId = animationId
        local animationTrack = animator:LoadAnimation(animation)
        animationTrack:Play()
        return animationTrack
    end
end

local activeAnimationTrack = nil

candle.Equipped:Connect(function()
    local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    if activeAnimationTrack then
        activeAnimationTrack:Stop()
    end
    activeAnimationTrack = playAnimation(character, "rbxassetid://11545520304")
end)

candle.Unequipped:Connect(function()
    local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    if activeAnimationTrack then
        activeAnimationTrack:Stop()
    end
    activeAnimationTrack = playAnimation(character, "rbxassetid://9982427158")
end)

local function onCharacterAdded(character)
    character.ChildAdded:Connect(function(child)
        if child:IsA("Tool") and child ~= candle then
            if activeAnimationTrack then
                activeAnimationTrack:Stop()
            end
        end
    end)
end

localPlayer.CharacterAdded:Connect(onCharacterAdded)
if localPlayer.Character then
    onCharacterAdded(localPlayer.Character)
end
